<div class="container mt-4">
  <!-- Filter Form -->
  <form (ngSubmit)="onSubmit()" #filterForm="ngForm" class="row g-3">
    <div class="col-md-3">
      <label for="from" class="form-label">From</label>
      <input type="datetime-local" id="from" [(ngModel)]="orderFilter.from" name="from" class="form-control" />
    </div>
    <div class="col-md-3">
      <label for="to" class="form-label">To</label>
      <input type="datetime-local" id="to" [(ngModel)]="orderFilter.to" name="to" class="form-control" />
    </div>
    <div class="col-md-3" *ngIf="isAdmin()">
      <label for="email" class="form-label">Email</label>
      <input type="email" id="email" [(ngModel)]="orderFilter.email" name="email" class="form-control" />
    </div>
    <div class="col-md-6">
      <label class="form-label">Statuses</label>
      <div class="form-check" *ngFor="let status of availableStatuses">
        <input
          class="form-check-input"
          type="checkbox"
          [value]="status"
          (change)="onStatusChange($event)"
          [checked]="orderFilter.statuses.includes(status)"
          id="status-{{status}}"
        />
        <label class="form-check-label" for="status-{{status}}">
          {{ status }}
        </label>
      </div>
    </div>
    <div class="col-md-3 align-self-end">
      <button type="submit" class="btn btn-primary w-100">Submit</button>
    </div>
  </form>

  <!-- Orders Table -->
  <div class="table-responsive mt-4">
    <table class="table table-striped table-bordered">
      <thead class="table-dark">
      <tr>
        <th>User Email</th>
        <th *ngIf="canTrack()">Status</th>
        <th>Ordered At</th>
        <th>Dishes</th>
        <th *ngIf="canCancel()">Cancel Order</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let order of orders">
        <td>{{ order.createdBy.email }}</td>
        <td *ngIf="canTrack()">{{ order.status }}</td>
        <td>{{ order.orderedAt | date: 'short' }}</td>
        <td>{{ order.dishes }}</td>
        <td *ngIf="canCancel()">
          <button
            *ngIf="order.active && order.status.startsWith('ORDERED')"
            class="btn btn-danger btn-sm"
            (click)="cancelOrder(order.id)">
            Cancel
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav class="mt-3">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="pageIndex === 0">
        <button class="page-link" (click)="previousPage()" [disabled]="pageIndex === 0">
          &laquo; Previous
        </button>
      </li>
      <li class="page-item disabled">
        <span class="page-link">Page {{ pageIndex + 1 }} of {{ totalPages }}</span>
      </li>
      <li class="page-item" [class.disabled]="pageIndex === totalOrders - 1">
        <button class="page-link" (click)="nextPage()" [disabled]="pageIndex === totalOrders - 1">
          Next &raquo;
        </button>
      </li>
    </ul>
  </nav>
</div>
